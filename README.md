import numpy as np
import matplotlib.pyplot as plt

# Define the voltage values at bus 3 and bus 4
V3 = np.array([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0])
V4 = np.array([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0])

# Define the admittance matrices Y3 and Y4
Y3 = np.array([[0.1563 - 3.8915j, 0.0670 + 2.9064j, 0.0916 + 0.5287j, 0.1144 + 0.6848j, 0.1608 + 0.7478j, 0.1309 + 0.5973j, 0.2104 + 0.8320j, 0.1608 + 0.7478j, 0.0826 + 0.2831j, 0.1961 + 1.5928j],
               [0.0670 + 2.9064j, 0.1563 - 3.8915j, 0.0670 + 2.9064j, 0.0916 + 0.5287j, 0.1144 + 0.6848j, 0.1608 + 0.7478j, 0.1309 + 0.5973j, 0.2104 + 0.8320j, 0.1608 + 0.7478j, 0.0826 + 0.2831j],
               [0.0916 + 0.5287j, 0.0670 + 2.9064j, 0.1563 - 3.8915j, 0.0670 + 2.9064j, 0.0916 + 0.5287j, 0.1608 + 0.7478j, 0.1309 + 0.5973j, 0.2104 + 0.8320j, 0.1608 + 0.7478j, 0.0826 + 0.2831j],
               [0.1144 + 0.6848j, 0.0916 + 0.5287j, 0.0670 + 2.9064j, 0.1563 - 3.8915j, 0.0670 + 2.9064j, 0.1309 + 0.5973j, 0.2104 + 0.8320j, 0.1608 + 0.7478j, 0.0826 + 0.2831j, 0.1961 + 1.5928j],
               [0.1608 + 0.7478j, 0.1144 + 0.6848j, 0.0916 + 0.5287j, 0.0670 + 2.9064j, 0.1563 - 3.8915j, 0.1309 + 0.5973j, 0.2104 + 0.8320j, 0.1608 + 0.7478j, 0.0826 + 0.2831j, 0.1961 + 1.5928j],
               [0.1309 + 0.5973j, 0.1608 + 0.7478j, 0.1608 + 0.7478j, 0.1309 + 0.5973j, 0.1309 + 0.5973j, 0.1961 + 1.5928j, 0.2104 + 0.8320j, 0.1608 + 0.7478j, 0.0826 + 0.2831j, 0.1961 + 1.5928j],
               [0.2104 + 0.8320j, 0.1309 + 0.5973j, 0.1309 + 0.5973j, 0.2104 + 0.8320j, 0.2104 + 0.8320j, 0.2104 + 0.8320j, 0.4267 - 11.0715j, 0.2104 + 0.8320j, 0.1309 + 0.5973j, 0.2104 + 0.8320j],
               [0.1608 + 0.7478j, 0.2104 + 0.8320j, 0.2104 + 0.8320j, 0.1608 + 0.7478j, 0.1608 + 0.7478j, 0.1608 + 0.7478j, 0.2104 + 0.8320j, 0.4811 - 10.0023j, 0.1608 + 0.7478j, 0.2104 + 0.8320j],
               [0.0826 + 0.2831j, 0.1608 + 0.7478j, 0.1608 + 0.7478j, 0.0826 + 0.2831j, 0.0826 + 0.2831j, 0.0826 + 0.2831j, 0.1309 + 0.5973j, 0.1608 + 0.7478j, 0.1563 - 3.8915j, 0.1608 + 0.7478j],
               [0.1961 + 1.5928j, 0.0826 + 0.2831j, 0.0826 + 0.2831j, 0.1961 + 1.5928j, 0.1961 + 1.5928j, 0.1961 + 1.5928j, 0.2104 + 0.8320j, 0.2104 + 0.8320j, 0.1608 + 0.7478j, 0.6412 - 16.8938j]])

Y4 = np.array([[0.1275 - 3.4084j, 0.0602 + 2.2828j, 0.0626 + 0.1259j, 0.0503 + 0.1147j, 0.0246 + 0.1411j, 0.0566 + 0.2610j, 0.1262 + 0.6649j, 0.0566 + 0.2610j, 0.1262 + 0.6649j, 0.2974 - 8.1663j],
               [0.0602 + 2.2828j, 0.1527 - 3.4695j, 0.0626 + 0.1259j, 0.0503 + 0.1147j, 0.0246 + 0.1411j, 0.0326 + 0.1446j, 0.0820 + 0.3649j, 0.0326 + 0.1446j, 0.0820 + 0.3649j, 0.1986 + 0.8729j],
               [0.0626 + 0.1259j, 0.0626 + 0.1259j, 0.1371 - 3.2975j, 0.0400 + 0.0880j, 0.0245 + 0.1410j, 0.0564 + 0.2607j, 0.1260 + 0.6645j, 0.0564 + 0.2607j, 0.1260 + 0.6645j, 0.2976 - 8.1661j],
               [0.0503 + 0.1147j, 0.0503 + 0.1147j, 0.0400 + 0.0880j, 0.1091 - 2.9505j, 0.0227 + 0.1177j, 0.0518 + 0.2634j, 0.1104 + 0.6141j, 0.0518 + 0.2634j, 0.1104 + 0.6141j, 0.2558 - 6.7784j],
               [0.0246 + 0.1411j, 0.0246 + 0.1411j, 0.0245 + 0.1410j, 0.0227 + 0.1177j, 0.1095 - 2.9256j, 0.0289 + 0.1355j, 0.0590 + 0.3143j, 0.0289 + 0.1355j, 0.0590 + 0.3143j, 0.1389 + 0.5992j],
               [0.0566 + 0.2610j, 0.0326 + 0.1446j, 0.0564 + 0.2607j, 0.0518 + 0.2634j, 0.0289 + 0.1355j, 0.1275 - 3.4084j, 0.1262 + 0.6649j, 0.0326 + 0.1446j, 0.0820 + 0.3649j, 0.1986 + 0.8729j],
               [0.1262 + 0.6649j, 0.0820 + 0.3649j, 0.1260 + 0.6645j, 0.1104 + 0.6141j, 0.0590 + 0.3143j, 0.1262 + 0.6649j, 0.2554 - 6.8238j, 0.0820 + 0.3649j, 0.1986 + 0.8729j, 0.4049 - 10.7401j],
               [0.0566 + 0.2610j, 0.0326 + 0.1446j, 0.0564 + 0.2607j, 0.0518 + 0.2634j, 0.0289 + 0.1355j, 0.0326 + 0.1446j, 0.0820 + 0.3649j, 0.1275 - 3.4695j, 0.0626 + 0.1259j, 0.1986 + 0.8729j],
               [0.1262 + 0.6649j, 0.0820 + 0.3649j, 0.1260 + 0.6645j, 0.1104 + 0.6141j, 0.0590 + 0.3143j, 0.0820 + 0.3649j, 0.1986 + 0.8729j, 0.0626 + 0.1259j, 0.1371 - 3.2975j, 0.2974 - 8.1663j],
               [0.2974 - 8.1663j, 0.1986 + 0.8729j, 0.2976 - 8.1661j, 0.2558 - 6.7784j, 0.1389 + 0.5992j, 0.1986 + 0.8729j, 0.4049 - 10.7401j, 0.1986 + 0.8729j, 0.2974 - 8.1663j, 0.7295 - 19.6049j]])

# Define the fault impedance
Zf = 0.1 + 1j * 1.0

# Define the current values at bus 3 with the fault current injection
I3 = np.array([0.0, 0.0, 10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0])  # Injecting 10 A at bus 3

# Calculate the bus currents
I = np.linalg.solve(Y3 + np.diag([Zf] * 10), Y4 @ np.conj(I3) - (np.conj(V3) - V4) / Zf)

# Print the bus currents
for i, current in enumerate(I):
    print(f"I{i + 1} = {current:.4f} A")

# Extract the real and imaginary parts of the currents for plotting
real_parts = np.real(I)
imaginary_parts = np.imag(I)

# Create a bar chart to visualize the real and imaginary parts of the currents
bus_numbers = range(1, len(I) + 1)
plt.bar(bus_numbers, real_parts, label='Real Part', width=0.4)
plt.bar(bus_numbers, imaginary_parts, label='Imaginary Part', width=0.4, bottom=real_parts)
plt.xlabel('Bus Number')
plt.ylabel('Current (A)')
plt.title('Bus Currents After Fault')
plt.legend()
plt.show()

